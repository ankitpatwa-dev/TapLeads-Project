
{% extends 'base.html' %}
{% block title %} Set Score {% endblock title %}

{% block css_links %}
<link rel="stylesheet" href="static/css/dashboard.css">
{% endblock css_links %}

{% block css %}
    <style>
        .main-margin{
            margin-top: 6rem;
        }
    </style>

{% endblock css %}

{% block main_content %}

            <div class="projects main-margin">
                <div class="card">
                    <div class="card-header">
                        <h4>Available methods</h4>
                    </div>
                    <br>
                    <div class="card-body"><center>
                        <form action="/set_score/select" method='POST'>
                            {% csrf_token %}
                            <div class="input-group input-group-icon">
                                <label for="method">Choose a Scoring Type:</label>
                                    <select name="method" id="method">
                                    </select>
                                </label>
                            </div>
                            <br>
                            <center><input type='submit' placeholder="Submit" class="fas fa-arrow-right"> </center>
                        </form>
                    </div>
                    <div class="card-footer">
                    </div>
                </div>
            </center>
            </div>
            <br>
           
           
           
        </div>
        </main>

        <script type="text/javascript">
            /*
            const fields = {
                "full_name": "Full Name",
                "first_name": "First Name",
                "middle_name": "Middle Name",
                "last_name": "Last Name",
                "company": "Company",
                "designation": "Designation",
                "emailid_primary": "Primary Email Id",
                "emailid_secondary": "Secondary Email Id",
                "aadhar": "Aadhar Card",
                "pan_card": "Pan Card",
                "phone": "Phone",
                "current_location": "Current Location",
                "preferred_location": "Preferred Location",
                "gender": "Gender",
                "title": "Title",
                "department": "Department",
                "university": "University",
                "degree": "Degree",
                "passing_year": "Passing Year",
                "college": "College",
                "linkedin": "Linkedin URL",
                "facebook": "Facebook URL",
                "instagram": "Instagram ID",
                "industry": "Industry",
                "country": "Country",
                "state": "State",
                "pin_code": "Pin Code",
                "key_skills": "Key Skills",
                "total_experience": "Total Exp",
                "years_in_business": "Years in Business",
                "cin_no": "CIN No",
                "turnover": "Turnover",
                "date_of_incorporation": "Date of Incorporation",
                "employees": "Employees",
                "ctc": "CTC",
                "notes": "Notes",
                "remarks": "Remarks",
            } */
            const selectedMethod = "{{current_method.id|safe}}"
            const existingMethods  = {{ methods|safe }};
            const appendMethod = (method, dropdown) => {
                const newOption = document.createElement('option');
                const optionText = document.createTextNode(method.fields.name);
                newOption.appendChild(optionText);
                if(method.pk == selectedMethod) newOption.setAttribute('selected', true)
                newOption.setAttribute('value', method.pk);
                dropdown.appendChild(newOption);
            }
            const existingMethodDropdown = document.getElementById("method")
            existingMethods.forEach((method) => {
                appendMethod(method, existingMethodDropdown);
            })

             /*
            const fieldDiv = document.getElementById("fields")
            const fieldDropdown = document.createElement('select')
            Object.entries(fields).forEach(([field, value]) => {
                const newOption = document.createElement('option');
                const optionText = document.createTextNode(value);
                newOption.appendChild(optionText);
                newOption.setAttribute('value', field);
                fieldDropdown.appendChild(newOption);
            })
            /*
            function parseInputs(data) {
                var ret = {};
            retloop:
                for (var input in data) {
                    var val = data[input];

                    var parts = input.split('[');
                    var last = ret;

                    for (var i in parts) {
                        var part = parts[i];
                        if (part.substr(-1) == ']') {
                            part = part.substr(0, part.length - 1);
                        }

                        if (i == parts.length - 1) {
                            last[part] = val;
                            continue retloop;
                        } else if (!last.hasOwnProperty(part)) {
                            last[part] = {};
                        }
                        last = last[part];
                    }
                }
                return ret;
            }
            let fieldIndex = 0
            let weightages = {}
            const totalDiv = document.getElementById('total')
            const updateTotalWeightages = () => {
                const total = Object.values(weightages)
                    .filter(a => !Number.isNaN(a))
                    .reduce((a, c) => a + c, 0)
                totalDiv.innerHTML = total
            }
            const addField = () => {
                const newField = document.createElement('div');

                const newFieldDropdown = fieldDropdown.cloneNode(true);
                newFieldDropdown.setAttribute('name',  `fields[${fieldIndex}][field]`)

                const weightageInput = document.createElement('input');
                weightageInput.setAttribute('name', `fields[${fieldIndex}][weightage]`);
                weightageInput.setAttribute('type', 'number');

                const updater = (function() {
                    const index = fieldIndex
                    return function(event) {
                        const value = parseInt(event.target.value)
                        weightages[index] = value
                        updateTotalWeightages()
                    }
                })();

                weightageInput.onkeyup = updater
                weightageInput.onchange = updater

                newField.append(newFieldDropdown)
                newField.append(weightageInput);
                fieldDiv.append(newField);
                fieldIndex += 1;
            }

            function getFormData(object) {
                const formData = new FormData();
                Object.keys(object).forEach(key => formData.append(key, object[key]));
                return formData;
            }

            const onSubmit = () => {
                let formData = new FormData(document.getElementById("new-method-form"))
                formData = Object.fromEntries(formData)
                const body = parseInputs(formData)
                fetch('', {
                    method: 'post',
                    body: JSON.stringify(body),
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                }).then(() => {
                    window.location.reload()
                })
            }
            */
        </script> 
{% endblock main_content %}


